<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photogram</title>
    <!-- Style -->
    <link rel="stylesheet" href="css/gongstagram_feed.css">
    <!-- Fontawesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" />

    <!-- AJAX-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
</head>

<body>
<header class="header">
    <div class="container">
        <a href="home.html" class="logo"><img src="img/logo_text.png" alt=""></a>
        <nav class="navi">
            <ul class="navi-list">
                <li class="navi-item"><a href="home.html"><i class="fas fa-home"></i></a></li>
                <li class="navi-item"><a href="explor.html"><i class="far fa-compass"></i></a></li>
                <li class="navi-item"><a href="profile.html"><i class="far fa-user"></i></a></li>
            </ul>
        </nav>
    </div>
</header>
<script>
    $(document).ready(function () {
        all_posts();
    });
    function all_posts() {


        $.ajax({
            type: "GET",
            url: `/gongstagram/post`,
            data: {},
            success: function (response) {
                console.log(response)
                let posts = response;
                let count = 0;
                for (let i = 0; i < posts.length; i++) {

                    let post = posts[i];

                    let id=post['id'];
                    let content = post['content'];

                    let temp_html = `<div class="story-list__item">
                                                    <div class="sl__item__header">
                                                        <div>
                                                            <img src="img/profile.jpeg" alt="">
                                                            <svg viewbox="0 0 110 110">
                                                                <circle cx="55" cy="55" r="53" />
                                                            </svg>
                                                        </div>
                                                        <div>사용자</div>
                                                        <div style="float: right">
                                                            <button type="button" onclick="open_modal(id)">수정</button>
                                                            <button type="button" onclick="delete_post(${id})">삭제</button>
                                                        </div>
                                                    </div>
                                                    <div class="sl__item__img">
                                                        <img src="images/home3.jpg" alt="">
                                                    </div>
                                                    <div class="sl__item__contents">
                                                        <div class="sl__item__contents__icon">
                                                            <button onclick="clickBtn()"><i class="far fa-heart"></i></button>
                                                        </div>
                                                        <div class="sl__item__contents__content">
                                                            <p>${content}</p>
                                                        </div>
                                                        <div class="sl__item__input">
                                                            <input type="text" placeholder="댓글 달기...">
                                                            <button>게시</button>
                                                        </div>
                                                    </div>
                                                </div>`;
                    $('.story-list').append(temp_html);


                }

            }


        })
    }

    function delete_post(id) {
        $.ajax({
            type: "DELETE",
            url: `/gongstagram/post/${id}`,
            success: function (response) {
                window.location.reload();
            }
        });
    }
    function open_modal(){
        $('#exampleModal').show();
    }
    function update_post(id) {

        let update_content = $('#modal-content').val();
        $.ajax({
            type: "PUT",
            url: `/gongstagram/post/${id}`,
            data: {content:update_content},
            success: function (response) {
                alert("수정 완료!");
                window.location.reload();
            }
        });
    }



    function likeOrUnLike(imageId) {
        let likeIcon = $("#like_icon_"+imageId);
        if (likeIcon.hasClass("far")) {
            $.ajax({
                type: "POST",
                url: `/image/${imageId}/likes`,
                dataType: "json"
            }).done(res=>{
                let likeCountStr  = $(`#like_count_${imageId}`).text();
                let likeCount = Number(likeCountStr) + 1;
                $(`#like_count_${imageId}`).text(likeCount);

                likeIcon.addClass("fas");
                likeIcon.addClass("active");
                likeIcon.removeClass("far");
            });



        } else {
            $.ajax({
                type: "DELETE",
                url: `/image/${imageId}/likes`,
                dataType: "json"
            }).done(res=>{
                let likeCountStr  = $(`#like_count_${imageId}`).text();
                let likeCount = Number(likeCountStr) - 1;
                $(`#like_count_${imageId}`).text(likeCount);

                likeIcon.removeClass("fas");
                likeIcon.removeClass("active");
                likeIcon.addClass("far");
            });

        }
    }
</script>
<main class="main">
    <section class="container">

        <article class="story-list">


<!--            <div class="story-list__item">-->
<!--                <div class="sl__item__header">-->
<!--                    <div>-->
<!--                        <img src="images/profile.jpeg" alt="">-->
<!--                        <svg viewbox="0 0 110 110">-->
<!--                            <circle cx="55" cy="55" r="53" />-->
<!--                        </svg>-->
<!--                    </div>-->
<!--                    <div>Jxxva._.SP</div>-->

<!--                </div>-->
<!--                <div class="sl__item__img">-->
<!--                    <img src="images/home3.jpg" alt="">-->
<!--                </div>-->
<!--                <div class="sl__item__contents">-->
<!--                    <div class="sl__item__contents__icon">-->
<!--                        <button onclick="clickBtn()"><i class="far fa-heart"></i></button>-->
<!--                    </div>-->
<!--                    <div class="sl__item__contents__content">-->
<!--                        <p>내용내용내용내용</p>-->
<!--                    </div>-->
<!--                    <div class="sl__item__input">-->
<!--                        <input type="text" placeholder="댓글 달기...">-->
<!--                        <button>게시</button>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
        </article>
    </section>
</main>
<div class="modal-container">
    <div class="modal">
        <button>신고</button>
        <button>팔로우 취소</button>
        <button id="cancel" onclick="closePopup()">취소</button>
    </div>
</div>
<div class="modal" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Edit Form</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form name="form" id="form" role="form" method="post">

                    <div class="mb-3">
                        <label for="modal-content">내용</label>
                        <textarea class="form-control" rows="5" name="content" id="modal-content"
                                  placeholder="내용을 입력해 주세요"></textarea>
                    </div>
<!--                    <div class="mb-3">-->
<!--                        <label for="tags">Tag</label>-->
<!--                        <input type="text" class="form-control" id="tags" data-role="tagsinput" placeholder="TAGS" >-->
<!--                    </div>-->
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <input type="submit" class="btn btn-secondary" id="modal-save" onclick="update_post()"
                       value="Save changes"></button>
            </div>
        </div>
    </div>
</div>

</body>
</html>